<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack - Super Simple</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; max-width: 800px; margin: 30px auto; text-align: center; background-color: #1a5f2a; min-height: 100vh; }
        h1 { color: #ffd700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-size: 2.5em; margin-bottom: 30px; }
        h3 { color: #fff; }
        h4 { color: #ffd700; margin-bottom: 15px; }
        .section { margin: 20px auto; padding: 20px; background: rgba(255,255,255,0.95); border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); max-width: 90%; }
        button { padding: 12px 24px; margin: 8px; font-size: 16px; cursor: pointer; background-color: #c41e3a; color: white; border: none; border-radius: 8px; transition: all 0.3s; font-weight: bold; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
        button:hover:not(:disabled) { background-color: #a01830; transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        input { padding: 12px; font-size: 16px; width: 220px; border: 2px solid #ddd; border-radius: 8px; text-align: center; }
        input:focus { outline: none; border-color: #c41e3a; }
        
        /* Card styles */
        .cards-container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin: 15px 0; min-height: 120px; align-items: center; }
        .card {
            width: 80px;
            height: 115px;
            background: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            position: relative;
            transition: transform 0.3s ease;
            border: 2px solid #ddd;
        }
        .card:hover { transform: translateY(-5px); }
        .card.red { color: #c41e3a; }
        .card.black { color: #1a1a1a; }
        .card .corner { position: absolute; font-size: 14px; }
        .card .corner-top { top: 5px; left: 8px; }
        .card .corner-bottom { bottom: 5px; right: 8px; transform: rotate(180deg); }
        .card .center { font-size: 36px; }
        
        .score { font-size: 20px; color: #333; font-weight: bold; margin-top: 10px; }
        .result { font-size: 28px; font-weight: bold; color: #2196F3; margin: 20px 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        .card-back {
            background: linear-gradient(135deg, #c41e3a 25%, #8b0000 25%, #8b0000 50%, #c41e3a 50%, #c41e3a 75%, #8b0000 75%);
            background-size: 15px 15px;
        }
        .card-back::after { content: ''; }
        #playerIdDisplay { color: #ffd700; font-weight: bold; font-size: 16px; margin-top: 10px; }
        #gameIdDisplay { font-weight: bold; color: #c41e3a; }
        
        /* Stats styles */
        .stats-container { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .stat-box { background: #f5f5f5; padding: 10px 20px; border-radius: 8px; text-align: center; min-width: 80px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #c41e3a; }
        .stat-label { font-size: 12px; color: #666; text-transform: uppercase; }
        .stat-wins .stat-value { color: #2e7d32; }
        .stat-losses .stat-value { color: #c62828; }
        .stat-pushes .stat-value { color: #f57c00; }
        
        /* Dashboard styles */
        .dashboard-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .dashboard-card {
            padding: 20px;
            border-radius: 12px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .dashboard-card .dashboard-value { font-size: 36px; font-weight: bold; margin-bottom: 5px; }
        .dashboard-card .dashboard-label { font-size: 14px; opacity: 0.9; }
        
        .dashboard-card.total { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .dashboard-card.wins { background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%); }
        .dashboard-card.losses { background: linear-gradient(135deg, #c62828 0%, #ef5350 100%); }
        .dashboard-card.pushes { background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%); }
        
        .winrate-bar { background: #ddd; border-radius: 10px; height: 20px; margin: 15px 0; overflow: hidden; }
        .winrate-fill { height: 100%; background: linear-gradient(90deg, #2e7d32, #4caf50); border-radius: 10px; transition: width 0.5s ease; }
        .winrate-text { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px; }
        
        .history-list { text-align: left; margin-top: 20px; }
        .history-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px;
            border-left: 4px solid #ddd;
        }
        .history-item.win { border-left-color: #2e7d32; }
        .history-item.loss { border-left-color: #c62828; }
        .history-item.push { border-left-color: #f57c00; }
        .history-result { font-weight: bold; }
        .history-result.win { color: #2e7d32; }
        .history-result.loss { color: #c62828; }
        .history-result.push { color: #f57c00; }
        .history-scores { color: #666; font-size: 14px; }
        .history-date { color: #999; font-size: 12px; }
        
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-dashboard { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-dashboard:hover:not(:disabled) { background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%); }
    </style>
</head>
<body>
    <h1>Blackjack</h1>
    <div class="section">
        <h3>üéÆ Login / Registrarse</h3>
        <input type="text" id="playerName" placeholder="Ingresa tu nombre">
        <button onclick="loginOrCreate()">Entrar</button>
        <div id="playerInfo" class="hidden">
            <p id="playerIdDisplay"></p>
            <button onclick="toggleDashboard()" class="btn-dashboard" id="btnDashboard">üìä Ver Dashboard</button>
            <div class="stats-container">
                <div class="stat-box stat-wins">
                    <div class="stat-value" id="statWins">0</div>
                    <div class="stat-label">Victorias</div>
                </div>
                <div class="stat-box stat-losses">
                    <div class="stat-value" id="statLosses">0</div>
                    <div class="stat-label">Derrotas</div>
                </div>
                <div class="stat-box stat-pushes">
                    <div class="stat-value" id="statPushes">0</div>
                    <div class="stat-label">Empates</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Section -->
    <div class="section hidden" id="dashboardSection">
        <div class="dashboard-header">
            <h3>üìä Tu Dashboard</h3>
            <button onclick="toggleDashboard()" style="padding: 8px 16px; font-size: 14px;">‚úï Cerrar</button>
        </div>
        <div class="dashboard-grid">
            <div class="dashboard-card total">
                <div class="dashboard-value" id="dashTotalGames">0</div>
                <div class="dashboard-label">Partidas Totales</div>
            </div>
            <div class="dashboard-card wins">
                <div class="dashboard-value" id="dashWins">0</div>
                <div class="dashboard-label">Victorias üèÜ</div>
            </div>
            <div class="dashboard-card losses">
                <div class="dashboard-value" id="dashLosses">0</div>
                <div class="dashboard-label">Derrotas ‚ùå</div>
            </div>
            <div class="dashboard-card pushes">
                <div class="dashboard-value" id="dashPushes">0</div>
                <div class="dashboard-label">Empates ü§ù</div>
            </div>
        </div>
        <div class="winrate-text">Tasa de Victoria: <span id="dashWinRate">0%</span></div>
        <div class="winrate-bar">
            <div class="winrate-fill" id="winRateFill" style="width: 0%"></div>
        </div>
        <h4 style="color: #333; margin-top: 30px;">üìú Historial de Partidas</h4>
        <div class="history-list" id="historyList">
            <p style="color: #666;">No hay partidas registradas a√∫n.</p>
        </div>
    </div>
    
    <div class="section hidden" id="startSection">
        <h3>üéØ Iniciar Juego</h3>
        <button onclick="startGame()">Nueva Partida</button>
    </div>
    <div class="section hidden" id="gameSection">
        <h3>üé∞ Partida en Curso</h3>
        <p>ID de Partida: <span id="gameIdDisplay"></span></p>
        <div class="section">
            <h4>üÉè Tu Mano</h4>
            <div class="cards-container" id="playerCards"></div>
            <div class="score">Puntuaci√≥n: <span id="playerScore"></span></div>
        </div>
        <div class="section">
            <h4>üé∞ Mano del Crupier</h4>
            <div class="cards-container" id="dealerCards"></div>
            <div class="score">Puntuaci√≥n: <span id="dealerScore"></span></div>
        </div>
        <div id="resultDisplay"></div>
        <button onclick="window.standFunction()" id="btnStand">‚úã Plantarse</button>
        <button onclick="window.hitFunction()" id="btnHit">üÉè Pedir Carta</button>
        <button onclick="newGame()" id="btnNewGame" class="hidden">üîÑ Nueva Partida</button>
        <button onclick="deleteGame()" id="btnDelete">üóëÔ∏è Eliminar</button>
    </div>
    <script>
        // Cache-busting version
        console.log("=== BLACKJACK JS LOADED v2 ===" + new Date().toISOString());
        let currentPlayerId = null;
        let currentGameId = null;
        
        // Initialize game state variables
        window.crupierTurnStarted = false;
        console.log(">>> Initialized crupierTurnStarted to:", window.crupierTurnStarted);
        
        // Global event listeners for buttons (backup to onclick attributes)
        document.addEventListener('DOMContentLoaded', function() {
            console.log("=== DOM loaded, setting up event listeners ===");
            
            const btnStand = document.getElementById('btnStand');
            if (btnStand) {
                btnStand.addEventListener('click', function(e) {
                    console.log("=== Stand button CLICKED via addEventListener ===");
                    e.preventDefault();
                    e.stopPropagation();
                    window.standFunction();
                });
                console.log(">>> Stand button event listener attached");
            }
            
            const btnHit = document.getElementById('btnHit');
            if (btnHit) {
                btnHit.addEventListener('click', function(e) {
                    console.log("=== Hit button CLICKED via addEventListener ===");
                    e.preventDefault();
                    e.stopPropagation();
                    window.hitFunction();
                });
                console.log(">>> Hit button event listener attached");
            }
        });
        
        // Global functions that buttons call
        window.standFunction = async function() {
            console.log(">>> standFunction called, currentGameId:", currentGameId);
            if (!currentGameId) {
                alert("No hay una partida activa");
                return;
            }
            
            try {
                console.log(">>> Calling /stand endpoint...");
                const response = await fetch("/games/" + currentGameId + "/stand", { method: "POST" });
                
                console.log(">>> Stand response status:", response.status);
                if (response.ok) {
                    const game = await response.json();
                    console.log(">>> Stand successful, gameStatus:", game.status);
                    updateGameDisplay(game);
                } else if (response.status === 400) {
                    const error = await response.json();
                    console.error(">>> Stand 400 error:", error);
                    document.getElementById("resultDisplay").innerHTML = "<div class=\"result\" style=\"color: #c62828\">" + (error.message || "No puedes plantarte ahora") + "</div>";
                } else {
                    alert("Error al plantarte: " + response.status);
                }
            } catch (error) {
                console.error(">>> Stand exception:", error);
                alert("Error de conexi√≥n al plantarte");
            }
        };
        
        window.hitFunction = async function() {
            console.log(">>> hitFunction called, currentGameId:", currentGameId);
            if (!currentGameId) {
                alert("No hay una partida activa");
                return;
            }
            
            // Immediately disable buttons
            const btnHit = document.getElementById("btnHit");
            const btnStand = document.getElementById("btnStand");
            if (btnHit) btnHit.disabled = true;
            if (btnStand) btnStand.disabled = true;
            
            try {
                console.log(">>> Calling /hit endpoint...");
                const response = await fetch("/games/" + currentGameId + "/hit", { method: "POST" });
                
                console.log(">>> Hit response status:", response.status);
                if (response.ok) {
                    const game = await response.json();
                    console.log(">>> Hit successful, gameStatus:", game.status);
                    updateGameDisplay(game);
                    
                    if (game.result && game.result !== "NO_RESULTS_YET") {
                        loginOrCreate();
                    }
                } else {
                    if (btnHit) btnHit.disabled = false;
                    if (btnStand) btnStand.disabled = false;
                }
            } catch (error) {
                console.error(">>> Hit exception:", error);
                if (btnHit) btnHit.disabled = false;
                if (btnStand) btnStand.disabled = false;
            }
        };
        
        async function loginOrCreate() {
            const name = document.getElementById("playerName").value;
            if (!name) return alert("Ingresa tu nombre");
            
            // Usar el endpoint /login que busca o crea el jugador
            const response = await fetch("/players/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: name })
            });
            
            if (response.ok) {
                const player = await response.json();
                currentPlayerId = player.id;
                
                // Mostrar informaci√≥n del jugador
                document.getElementById("playerIdDisplay").textContent = "üë§ " + player.name + " (ID: " + player.id + ")";
                
                // Mostrar estad√≠sticas
                document.getElementById("statWins").textContent = player.wins;
                document.getElementById("statLosses").textContent = player.losses;
                document.getElementById("statPushes").textContent = player.pushes;
                
                // Actualizar dashboard
                updateDashboard(player.wins, player.losses, player.pushes);
                
                // Mostrar el div de informaci√≥n del jugador
                document.getElementById("playerInfo").classList.remove("hidden");
                document.getElementById("startSection").classList.remove("hidden");
            }
        }
        
        function toggleDashboard() {
            const dashboard = document.getElementById("dashboardSection");
            if (dashboard.classList.contains("hidden")) {
                dashboard.classList.remove("hidden");
                document.getElementById("btnDashboard").textContent = "‚úï Ocultar";
                loadPlayerStats();
            } else {
                dashboard.classList.add("hidden");
                document.getElementById("btnDashboard").textContent = "üìä Ver Dashboard";
            }
        }
        
        async function loadPlayerStats() {
            if (!currentPlayerId) return;
            
            try {
                const response = await fetch("/players/" + currentPlayerId + "/stats");
                if (response.ok) {
                    const stats = await response.json();
                    updateDashboard(stats.totalGames, stats.wins, stats.losses, stats.pushes);
                    updateHistoryList(stats.recentGames);
                } else {
                    // Si no hay endpoint de stats, usar datos del jugador
                    console.log("Stats endpoint not available, using basic stats");
                }
            } catch (error) {
                console.log("Could not load stats:", error.message);
            }
        }
        
        function updateDashboard(total, wins, losses, pushes) {
            total = total || 0;
            wins = wins || 0;
            losses = losses || 0;
            pushes = pushes || 0;
            
            document.getElementById("dashTotalGames").textContent = total;
            document.getElementById("dashWins").textContent = wins;
            document.getElementById("dashLosses").textContent = losses;
            document.getElementById("dashPushes").textContent = pushes;
            
            // Calcular porcentaje de victorias
            const winRate = total > 0 ? Math.round((wins / total) * 100) : 0;
            document.getElementById("dashWinRate").textContent = winRate + "%";
            document.getElementById("winRateFill").style.width = winRate + "%";
            
            // Also update the small stats
            document.getElementById("statWins").textContent = wins;
            document.getElementById("statLosses").textContent = losses;
            document.getElementById("statPushes").textContent = pushes;
        }
        
        function updateHistoryList(recentGames) {
            const historyList = document.getElementById("historyList");
            
            if (!recentGames || recentGames.length === 0) {
                historyList.innerHTML = '<p style="color: #666;">No hay partidas registradas a√∫n.</p>';
                return;
            }
            
            const historyHtml = recentGames.map(function(game) {
                let resultClass = "";
                let resultText = "";
                
                if (game.result === "PLAYER_WINS") {
                    resultClass = "win";
                    resultText = "Victoria üèÜ";
                } else if (game.result === "CRUPIER_WINS") {
                    resultClass = "loss";
                    resultText = "Derrota ‚ùå";
                } else {
                    resultClass = "push";
                    resultText = "Empate ü§ù";
                }
                
                const date = new Date(game.playedAt).toLocaleDateString("es-ES", {
                    day: "numeric", month: "short", hour: "2-digit", minute: "2-digit"
                });
                
                return '<div class="history-item ' + resultClass + '">' +
                    '<div>' +
                    '<span class="history-result ' + resultClass + '">' + resultText + '</span>' +
                    '<span class="history-scores"> | ' + game.playerScore + '-' + game.dealerScore + '</span>' +
                    '</div>' +
                    '<span class="history-date">' + date + '</span>' +
                    '</div>';
            }).join("");
            
            historyList.innerHTML = historyHtml;
        }
        
        async function startGame() {
            if (!currentPlayerId) return alert("Create a player first");
            
            // Reset game state variables for new game
            window.crupierTurnStarted = false;
            
            const response = await fetch("/games/new", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ playerId: currentPlayerId })
            });
            if (response.ok) {
                const game = await response.json();
                currentGameId = game.id;
                document.getElementById("gameIdDisplay").textContent = game.id;
                document.getElementById("gameSection").classList.remove("hidden");
                updateGameDisplay(game);
            }
        }
        
        // Keep old function names as aliases for backward compatibility
        async function hit() { return window.hitFunction(); }
        async function stand() { return window.standFunction(); }
        
        async function newGame() {
            // Reset game state variables for new game
            window.crupierTurnStarted = false;
            
            document.getElementById("btnHit").classList.remove("hidden");
            document.getElementById("btnStand").classList.remove("hidden");
            document.getElementById("btnNewGame").classList.add("hidden");
            document.getElementById("resultDisplay").innerHTML = "";
            startGame();
        }
        
        async function deleteGame() {
            if (!currentGameId) {
                console.log("No game to delete");
                return;
            }
            
            const btnDelete = document.getElementById("btnDelete");
            btnDelete.disabled = true;
            btnDelete.textContent = "Eliminando...";
            
            try {
                const response = await fetch("/games/" + currentGameId + "/delete", { method: "DELETE" });
                
                if (response.ok) {
                    console.log("Game deleted successfully");
                    currentGameId = null;
                    document.getElementById("gameSection").classList.add("hidden");
                } else {
                    console.error("Failed to delete game, status:", response.status);
                    alert("Error al eliminar la partida");
                }
            } catch (error) {
                console.error("Error deleting game:", error);
                alert("Error al eliminar la partida: " + error.message);
            } finally {
                btnDelete.disabled = false;
                btnDelete.textContent = "üóëÔ∏è Eliminar";
            }
        }
        
        function createCardElement(card) {
            const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
            const suitSymbol = card.suit;
            const rankDisplay = card.rank;
            
            return '<div class="card ' + (isRed ? 'red' : 'black') + '">' +
                '<span class="corner corner-top">' + rankDisplay + '</span>' +
                '<span class="center">' + suitSymbol + '</span>' +
                '<span class="corner corner-bottom">' + rankDisplay + '</span>' +
                '</div>';
        }
        
        function updateGameDisplay(game) {
            console.log("=== DEBUG updateGameDisplay ===");
            console.log("gameStatus:", game.status);  // Fixed: was game.gameStatus
            console.log("result:", game.result);
            console.log("player.status:", game.player.status);
            console.log("player.score:", game.player.score);
            console.log("crupierScore:", game.crupierScore);
            console.log("crupierHand length:", game.crupierHand ? game.crupierHand.length : 0);
            console.log("window.crupierTurnStarted:", window.crupierTurnStarted);
            
            // Clear result display first - only show result when game is actually finished
            document.getElementById("resultDisplay").innerHTML = "";
            
            // Create visual cards for player
            const playerCardsHtml = game.player.hand.map(function(c) { return createCardElement(c); }).join("");
            document.getElementById("playerCards").innerHTML = playerCardsHtml;
            document.getElementById("playerScore").textContent = game.player.score;
            
            // Create visual cards for dealer (show face up cards)
            const dealerCardsHtml = game.crupierHand.map(function(c) { return createCardElement(c); }).join("");
            document.getElementById("dealerCards").innerHTML = dealerCardsHtml;
            document.getElementById("dealerScore").textContent = game.crupierScore;

            // Detect the dealer turn - FIXED: use global crupierPlayStep function
            if (game.status === "CRUPIER_TURN" && !window.crupierTurnStarted) {
                window.crupierTurnStarted = true;
                console.log(">>> Starting dealer turn... gameStatus=" + game.status + ", crupierTurnStarted=" + window.crupierTurnStarted);
                setTimeout(crupierPlayStep, 1000);
            } else {
                console.log(">>> NOT starting dealer turn: gameStatus=" + game.status + ", crupierTurnStarted=" + window.crupierTurnStarted);
            }

            // Get button references
            const btnHit = document.getElementById("btnHit");
            const btnStand = document.getElementById("btnStand");
            const btnNewGame = document.getElementById("btnNewGame");
            
            // Show result ONLY for final results, not for NO_RESULTS_YET
            const isFinalResult = game.result && game.result !== "NO_RESULTS_YET";
            console.log("isFinalResult:", isFinalResult);
            
            if (isFinalResult) {
                console.log(">>> GAME FINISHED! Result:", game.result);
                
                // Map backend result names to display names
                const resultMap = {
                    "PLAYER_WINS": "¬°GANASTE! üéâ",
                    "CRUPIER_WINS": "PERDISTE üòî",
                    "PUSH": "EMPATE ü§ù",
                    "BLACKJACK": "¬°BLACKJACK! üèÜ"
                };
                const displayResult = resultMap[game.result] || game.result;
                const colors = {
                    "¬°GANASTE! üéâ": "#2e7d32",
                    "PERDISTE üòî": "#c62828",
                    "EMPATE ü§ù": "#f57c00",
                    "¬°BLACKJACK! üèÜ": "#ffd700"
                };
                const resultHtml = "<div class=\"result\" style=\"color: " + colors[displayResult] + "\">" + displayResult + "</div>";
                document.getElementById("resultDisplay").innerHTML = resultHtml;
                console.log(">>> Result HTML set:", resultHtml);
                
                // Hide action buttons, show new game button
                btnHit.classList.add("hidden");
                btnStand.classList.add("hidden");
                btnNewGame.classList.remove("hidden");
                
                // Disable buttons
                btnHit.disabled = true;
                btnStand.disabled = true;
            } else {
                console.log(">>> Game continues (status:", game.status, ")");
                
                // Disable buttons based on player status
                const playerStatus = game.player.status;
                const canHit = playerStatus === "ACTIVE";
                const canStand = playerStatus === "ACTIVE";
                
                // Show action buttons, hide new game button
                btnHit.classList.remove("hidden");
                btnStand.classList.remove("hidden");
                btnNewGame.classList.add("hidden");
                
                // Apply disabled state
                btnHit.disabled = !canHit;
                btnStand.disabled = !canStand;
            }
        }
        
        // FIXED: Moved crupierPlayStep to GLOBAL scope so setTimeout can access it
        async function crupierPlayStep() {
            console.log(">>> crupierPlayStep called, currentGameId:", currentGameId, ", window.crupierTurnStarted:", window.crupierTurnStarted);
            if (!currentGameId) {
                console.log(">>> No game ID, stopping dealer turn");
                return;
            }
            console.log(">>> Dealer hitting... gameId:", currentGameId);

            try {
                const response = await fetch("/games/" + currentGameId + "/crupier-hit", {
                    method: "POST"
                });

                if (response.ok) {
                    const game = await response.json();
                    console.log(">>> Dealer received response, status:", game.status);
                    updateGameDisplay(game);

                    // If the dealer finished playing, refresh the player stats
                    if (game.status === "FINISHED" && game.result && game.result !== "NO_RESULTS_YET") {
                        console.log(">>> Dealer finished, refreshing stats...");
                        loginOrCreate(); // Refresh player stats
                    }

                    // Si el crupier sigue jugando, continuar despu√©s de 1 segundo
                    if (game.status === "CRUPIER_TURN") {
                        console.log(">>> Dealer continues, scheduling next hit...");
                        setTimeout(crupierPlayStep, 1000);
                    }
                } else {
                    console.error(">>> Dealer hit failed:", response.status);
                    const errorText = await response.text();
                    console.error(">>> Error response:", errorText);
                }
            } catch (error) {
                console.error(">>> Dealer hit exception:", error);
            }
        }
    </script>
</body>
</html>
